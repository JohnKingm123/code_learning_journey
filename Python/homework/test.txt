ps 命令可以一次性给出当前系统中进程状态，但使用此方式得到的信息缺乏时效性，并且，如果管理员需要实时监控进程运行情况，就必须不停地执行 ps 命令，这显然是缺乏效率的。

为此，Linux 提供了 top 命令。top 命令可以动态地持续监听进程地运行状态，与此同时，该命令还提供了一个交互界面，用户可以根据需要，人性化地定制自己的输出，进而更清楚地了进程的运行状态。

top 命令的基本格式如下：

[root@localhost ~]#top [选项]
选项：
-d 秒数：指定 top 命令每隔几秒更新。默认是 3 秒；
-b：使用批处理模式输出。一般和"-n"选项合用，用于把 top 命令重定向到文件中；
-n 次数：指定 top 命令执行的次数。一般和"-"选项合用；
-p 进程PID：仅查看指定 ID 的进程；
-s：使 top 命令在安全模式中运行，避免在交互模式中出现错误；
-u 用户名：只监听某个用户的进程；

在 top 命令的显示窗口中，还可以使用如下按键，进行一下交互操作：

? 或 h：显示交互模式的帮助；
P：按照 CPU 的使用率排序，默认就是此选项；
M：按照内存的使用率排序；
N：按照 PID 排序；
T：按照 CPU 的累积运算时间排序，也就是按照 TIME+ 项排序；
k：按照 PID 给予某个进程一个信号。一般用于中止某个进程，信号 9 是强制中止的信号；
r：按照 PID 给某个进程重设优先级（Nice）值；
q：退出 top 命令；

我们看看 top 命令的执行结果，如下：
[root@localhost ~]# top top - 12:26:46 up 1 day, 13:32, 2 users, load average: 0.00, 0.00, 0.00 Tasks: 95 total, 1 running, 94 sleeping, 0 stopped, 0 zombie Cpu(s): 0.1%us, 0.1%sy, 0.0%ni, 99.7%id, 0.1%wa, 0.0%hi, 0.1%si, 0.0%st Mem: 625344k total, 571504k used, 53840k free, 65800k buffers Swap: 524280k total, 0k used, 524280k free, 409280k cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 19002 root 20 0 2656 1068 856 R 0.3 0.2 0:01.87 top 1 root 20 0 2872 1416 1200 S 0.0 0.2 0:02.55 init 2 root 20 0 0 0 0 S 0.0 0.0 0:00.03 kthreadd 3 root RT 0 0 0 0 S 0.0 0.0 0:00.00 migration/0 4 root 20 0 0 0 0 S 0.0 0.0 0:00.15 ksoftirqd/0 5 root RT 0 0 0 0 S 0.0 0.0 0:00.00 migration/0 6 root RT 0 0 0 0 S 0.0 0.0 0:10.01 watchdog/0 7 root 20 0 0 0 0 S 0.0 0.0 0:05.01 events/0 8 root 20 0 0 0 0 S 0.0 0.0 0:00.00 cgroup 9 root 20 0 0 0 0 S 0.0 0.0 0:00.00 khelper 10 root 20 0 0 0 0 S 0.0 0.0 0:00.00 netns 11 root 20 0 0 0 0 S 0.0 0.0 0:00.00 async/mgr 12 root 20 0 0 0 0 S 0.0 0.0 0:00.00 pm 13 root 20 0 0 0 0 S 0.0 0.0 0:01.70 sync_supers 14 root 20 0 0 0 0 S 0.0 0.0 0:00.63 bdi-default 15 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kintegrityd/0 16 root 20 0 0 0 0 S 0.0 0.0 0:02.52 kblockd/0 17 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kacpid 18 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kacpi_notify
我们解释一下命令的输出。top 命令的输出内容是动态的，默认每隔 3 秒刷新一次。命令的输出主要分为两部分：

第一部分是前五行，显示的是整个系统的资源使用状况，我们就是通过这些输出来判断服务器的资源使用状态的；
第二部分从第六行开始，显示的是系统中进程的信息；

我们先来说明第一部分的作用。

第一行为任务队列信息，具体内容如表 1 所示。


表 1 任务队列信息
内 容
说 明
12:26:46
系统当前时间
up 1 day, 13:32
系统的运行时间.本机己经运行 1 天 13 小时 32 分钟
2 users
当前登录了两个用户
load average: 0.00,0.00，0.00
系统在之前 1 分钟、5 分钟、15 分钟的平均负载。如果 CPU 是单核的，则这个数值超过 1 就是高负载：如果 CPU 是四核的，则这个数值超过 4 就是高负载 （这个平均负载完全是依据个人经验来进行判断的，一般认为不应该超过服务器 CPU 的核数）


第二行为进程信息，具体内容如表 2 所示。


表 2 进程信息
内 容
说 明
Tasks: 95 total
系统中的进程总数
1 running
正在运行的进程数
94 sleeping
睡眠的进程数
0 stopped
正在停止的进程数
0 zombie
僵尸进程数。如果不是 0，则需要手工检查僵尸进程


第三行为 CPU 信息，具体内容如表 3 所示。


表 3 CPU信息
内 容
说 明
Cpu(s): 0.1 %us
用户模式占用的 CPU 百分比
0.1%sy
系统模式占用的 CPU 百分比
0.0%ni
改变过优先级的用户进程占用的 CPU 百分比
99.7%id
空闲 CPU 占用的 CPU 百分比
0.1%wa
等待输入/输出的进程占用的 CPU 百分比
0.0%hi
硬中断请求服务占用的 CPU 百分比
0.1%si
软中断请求服务占用的 CPU 百分比
0.0%st
st（steal time）意为虚拟时间百分比，就是当有虚拟机时，虚拟 CPU 等待实际 CPU 的时间百分比


第四行为物理内存信息，具体内容如表 4 所示。


表 4 物理内存信息
内 容
说 明
Mem: 625344k total
物理内存的总量，单位为KB
571504k used
己经使用的物理内存数量
53840k&ee
空闲的物理内存数量。我们使用的是虚拟机，共分配了 628MB内存，所以只有53MB的空闲内存
65800k buffers
作为缓冲的内存数量


第五行为交换分区（swap）信息，如表 5 所示。


表 5 交换分区信息
内 容
说 明
Swap: 524280k total
交换分区（虚拟内存）的总大小
Ok used
已经使用的交换分区的大小
524280k free
空闲交换分区的大小
409280k cached
作为缓存的交换分区的大小

我们通过 top 命令的第一部分就可以判断服务器的健康状态。如果 1 分钟、5 分钟、15 分钟的平均负载高于 1，则证明系统压力较大。如果 CPU 的使用率过高或空闲率过低，则证明系统压力较大。如果物理内存的空闲内存过小，则也证明系统压力较大。

这时，我们就应该判断是什么进程占用了系统资源。如果是不必要的进程，就应该结束这些进程；如果是必需进程，那么我们该増加服务器资源（比如増加虚拟机内存），或者建立集群服务器。

我们还要解释一下缓冲（buffer）和缓存（cache）的区别：
缓存（cache）是在读取硬盘中的数据时，把最常用的数据保存在内存的缓存区中，再次读取该数据时，就不去硬盘中读取了，而在缓存中读取。
缓冲（buffer）是在向硬盘写入数据时，先把数据放入缓冲区,然后再一起向硬盘写入，把分散的写操作集中进行，减少磁盘碎片和硬盘的反复寻道，从而提高系统性能。
简单来说，缓存（cache）是用来加速数据从硬盘中"读取"的，而缓冲（buffer）是用来加速数据"写入"硬盘的。

再来看 top 命令的第二部分输出，主要是系统进程信息，各个字段的含义如下：

PID：进程的 ID。
USER：该进程所属的用户。
PR：优先级，数值越小优先级越高。
NI：优先级，数值越小、优先级越高。
VIRT：该进程使用的虚拟内存的大小，单位为 KB。
RES：该进程使用的物理内存的大小，单位为 KB。
SHR：共享内存大小，单位为 KB。
S：进程状态。
%CPU：该进程占用 CPU 的百分比。
%MEM：该进程占用内存的百分比。
TIME+：该进程共占用的 CPU 时间。
COMMAND：进程的命令名。

这部分和 ps 命令的输出比较类似，只是如果在终端执行 top 命令，则不能看到所有的进程，而只能看到占比靠前的进程。接下来我们举几个 top 命令常用的实例。

【例 1】如果只想让 top 命令查看某个进程，就可以使用 "-p 选项"。命令如下：

[root@localhost ~]# top -p 15273 #只查看 PID为 15273的apache进程 top - 14:28:47 up 1 day, 15:34, 3 users, load average: 0.00,0.00,0.00 Tasks: 1 total, 0 running, 1 sleeping, 0 stopped, 0 zombie Cpu(s): 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st Mem: 625344k total, 574124k used, 51220k free, 67024k buffers Swap: 524280k total, Ok used, 524280k free, 409344k cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 15273 daemon 20 0 4520 1192 580 S 0.0 0.2 0:00.00 httpd

【例 2】top 命令如果不正确退出，则会持续运行。在 top 命令的交互界面中按 "q" 键会退出 top 命令；也可以按 "?" 或 "h" 键得到 top 命令交互界面的帮助信息；还可以按键中止某个进程。比如：

[root@localhost ~]# top top - 14:10:15 up 1 day, 15:15， 3 users, load average: 0.00，0.00, 0.00 Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie Cpu(s): 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st Mem: 625344k total, 574248k used, 51096k free, 66840k buffers Swap: 524280k total, Ok used, 524280k free, 409324k cached PID to kill:15273 #按"k"键，会提示输入要杀死进程的PID PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 15273 daemon 20 0 4520 1192 580 S 0.0 0.2 0:00.00 httpd ..省略部分输出...

【例 3】输入要中止进程的 PID，比如要中止 15273 这个 apache 进程，命令如下：

top - 14:11:42 up 1 day, 15:17， 3 users, load average: 0.00，0.00, 0.00 Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie Cpu(s): 0.0%us, 0.3%sy, 0.0%ni, 99.7%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st Mem: 625344k total, 574248k used, 51096k free, 66856k buffers Swap: 524280k total, 0k used, 524280k free, 409324k cached Kill PID 15273 with signal [15]:9 #提示输入信号，信号9代表强制中止 PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 15273 daemon 20 0 4520 1192 580 S 0.0 0.2 0:00.00 httpd …省略部分输出…
接下来 top 命令提示我们输入信号，信号 9 代表强制中止，这时就能够强制中止 15273 进程了。

【例 4】如果要改变某个进程的优先级，就要利用 "r" 交互命令。需要注意的是，我们能够修改的只有 Nice 的优先级，而不能修改 Priority 的优先级。具体修改命令如下：

[root@localhost ~]# top -p 18977 top - 14:17:09 up 1 day, 15:22, 3 users, load average: 0.00，0.00, 0.00 Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie Cpu(s): 0.3%us, 0.0%sy, 0.0%ni, 99.7%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st Mem: 625344k total, 574124k used, 51220k free, 66896k buffers Swap: 524280k total, 0k used, 524280k free, 409324k cached PID to renice: #输入"r"交互命令之后，提示输入要修改优先级的进程的PID PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 18977 root 20 0 11592 3304 2572 S 0.0 0.5 0:04.37 sshd
输入 "r" 交互命令，会提示输入需要修改优先级的进程的 PID。例如，我们想要修改 18977 这个 sshd 远程连接进程的优先级，就输入该进程的 PID。命令如下：

Renice PID 18977 to value: 10 #输入PID后，需要输入Nice的优先级号 #我们把18977进程的优先级调整为10,回车后就能看到 PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 18977 root 30 10 11592 3304 2572 R 0.0 0.5 0:04.38 sshd #18977进程的优先级已经被修改了
【例 5】如果在操作终端执行 top 命令，则并不能看到系统中所有的进程，默认看到的只是 CPU 占比靠前的进程。如果我们想要看到所有的进程，则可以把 top 命令的执行结果重定向到文件中。不过 top 命令是持续运行的，这时就需要使用 "-b" 和 "-n" 选项了。具体命令如下：
[root@localhost ~]# top -b -n 1 > /root/top.log
#让top命令只执行一次，然后把执行结果保存到top.log文件中，这样就能看到所有的进程了
关注微信公众号「站长严长生」，在手机上阅读所有教程，随时随地都能学习。本公众号由C语言中文网站长运营，每日更新，坚持原创，敢说真话，凡事有态度。

微信扫描二维码关注公众号
< 上一页Linux如何查看正在运行的进程（ps命令） Linux查看进程树（pstree命令）下一页 >
优秀文章
Go语言可变参数（变参函数）
Python pass语句及其作用
汇编语言指令详解
Python assert调试程序
Java lastIndexOf()方法：返回最后一次出现的索引位置
PHP include和require：文件包含语句
如何从TFTP服务器下载文件？
MATLAB运算符优先级一览表
Java反射机制是什么？
jQuery filter()和has()方法
// 当前文章ID window.arcIdRaw = 'a_' + 1065; window.arcId = "27991LgAzVxvNCwg7Ezq7yQ6NOPkY996kzYszdaYHVjBNhfDrzdtFUmuRi8"; window.typeidChain = "104|77";
精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。
关于网站 | 关于站长 | 如何完成一部教程 | 联系我们 | 网站地图
Copyright ©2012-2022 biancheng.net, 陕ICP备15000209号
↑
window.siteId = 4; window.cmsTemplets = "/templets/new"; window.cmsTempletsVer = "1.6.73";